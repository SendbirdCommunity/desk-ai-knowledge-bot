
# Sendbird Desk Chatbot Integration

This project provides a simple Node.js server to integrate a custom chatbot in Sendbird Desk using an iFrame. The chatbot interface is rendered with React and Sendbirdâ€™s Chat AI Widget, enabling users to interact with the bot directly within Sendbird Desk.

## Features

- Serves an HTML page that renders a chatbot UI in an iFrame within Sendbird Desk.
- Uses a security key for authorization to protect access to the chatbot interface.
- Embeds the Sendbird Chat AI Widget using React to create a customizable chatbot experience.

## Prerequisites

- **Node.js**: Ensure Node.js is installed to run this server.
- **Sendbird Desk Access**: Configure iFrame integration within Sendbird Desk.
- **Secret Key**: Obtain the secret key from Sendbird Desk's iFrame integration settings for security validation.

## Setup

1. **Clone the Repository**:
   ```bash
   git clone https://github.com/your-username/sendbird-chatbot-integration.git
   cd sendbird-chatbot-integration
   ```

2. **Install Dependencies**:
   ```bash
   npm install express cors
   ```

3. **Configure Sendbird Desk**:
   - Go to **Settings** > **Desk** > **Integrations** in the Sendbird Dashboard.
   - Enable **iFrame Sidebar** and configure the following:
     - **Secret Key**: Auto-generated by Sendbird Desk (copy this for later use).
     - **Title**: Set a title, such as "Internal Knowledge AI".
     - **URL**: Set the URL where this server will be hosted, ending with `/deskcalls` (e.g., `https://yourdomain.com/deskcalls`).
     - **Width**: Adjust as needed (e.g., `336` pixels).
   - Save the settings.

## Running the Server

1. **Start the Server**:
   ```bash
   node server.js
   ```

2. The server will start on `http://localhost:3000`, listening for requests on the `/deskcalls` endpoint.

## Code Overview

- **Dependencies**:
  - `express`: To create the server and handle HTTP requests.
  - `cors`: Enables Cross-Origin Resource Sharing for iFrame access within Sendbird Desk.

- **Server Logic**:
  - The server listens on `*/deskcalls`.
  - It retrieves the `x-secret-key` from the request headers to validate incoming requests.
  - If the `x-secret-key` matches the expected value, it serves an HTML page containing the chatbot UI.
  - If the `x-secret-key` is missing or incorrect, it returns an error.

### Key Parts of the Code

```javascript
const express = require("express");
const cors = require("cors");

const app = express();
const port = 3000;

app.use(cors());
app.options("*", cors());

app.use(express.json());
```

- **Initialization**: Sets up the Express server with CORS enabled for cross-origin requests, necessary for the iFrame integration.

```javascript
app.get('*/deskcalls', async (req, res) => {
    console.log("working");

    // Retrieve headers and query parameters
    let xSignature = req.headers["x-secret-key"];
    console.log(xSignature);
    const agent_id = req.query.agent_id;
    const html_key = req.query.html_key;
    const app_id = req.originalUrl.split("/")[1];
    const botId = "banana-drama";
```

- **Endpoint Definition**: Defines the `/deskcalls` endpoint. Extracts `x-secret-key` from headers and validates it against the known secret key.

```javascript
if (xSignature === 'cafef9ee8dea20d7da4d085fe0f39df144565566') {
    res.send(`...`); // Serves the chatbot HTML page with Sendbird's Chat AI Widget
} else if (!xSignature) {
    res.status(400).send("Error: Missing 'x-secret-key' header!");
} else {
    res.status(403).send("Not Authorized");
}
```

- **Authorization**: Validates the request by checking the `x-secret-key`. If valid, it serves the chatbot UI; if not, it returns an error.

## Testing the Integration

1. **Open a Ticket in Sendbird Desk**:
   - Navigate to a ticket in Sendbird Desk to see the iFrame sidebar with the chatbot.

2. **Interacting with the Chatbot**:
   - You should see the chatbot titled "Internal Knowledge AI" on the right sidebar. Test interactions to ensure it responds as expected.

## Security

This server uses a secret key (`x-secret-key`) to authorize requests. Make sure to keep this key secure and do not expose it publicly.

## Dependencies

- [express](https://www.npmjs.com/package/express)
- [cors](https://www.npmjs.com/package/cors)

## License

This project is licensed under the MIT License. See [LICENSE](LICENSE) for details.
